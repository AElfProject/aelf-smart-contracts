syntax = "proto3";

option csharp_namespace = "AElf.CrossChain";

import "common.proto";
import "core.proto";
import "google/protobuf/timestamp.proto";

message CrossChainRequest {
    int32 FromChainId = 1; // own chain id
    int64 NextHeight = 2;
    int32 ListeningPort = 3;
}

message CrossChainResponse {
    BlockData BlockData = 1;
}

message HandShake {
    int32 ListeningPort = 1;
    int32 fromChainId = 2;
    bool fromSideChain = 3;
}

message HandShakeReply {
    bool Result = 1;
}

message SideChainInitializationRequest{
    int32 chainId =1;
}

message SideChainInitializationResponse{
    ChainInitializationContext SideChainInitializationContext = 1; 
}

service CrossChainRpc {
    rpc RequestIndexingFromSideChain (CrossChainRequest) returns (stream CrossChainResponse) {}
    rpc RequestIndexingFromParentChain (CrossChainRequest) returns (stream CrossChainResponse) {}
    rpc CrossChainIndexingShake (HandShake) returns (HandShakeReply) {} // only side chain shake with parent chain.
    rpc RequestChainInitializationContextFromParentChain (SideChainInitializationRequest) returns (SideChainInitializationResponse) {}
}

message BlockData{
    int32 chainId = 1;
    int64 height = 2;
    bytes payload = 3;
}

message ChainInitializationContext{
    int32 chainId =1;
    Address Creator = 2;
    google.protobuf.Timestamp CreationTimestamp = 3;
    repeated bytes ExtraInformation = 4;
    int64 ParentChainHeightOfCreation = 5;
}
